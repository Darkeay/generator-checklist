<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Generator Checklist</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    input, select, textarea, button { width: 100%; padding: 8px; margin-bottom: 10px; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    .instructions { font-size: 0.9em; color: #555; margin-bottom: 5px; }
    .edit-button { background: #ffc107; color: #000; }
    .add-button { background: #28a745; color: white; width: auto; padding: 5px 10px; float: right; margin-top: -42px; margin-right: 5px; font-size: 0.8em; }
    .check-item img { max-width: 100px; display: block; margin-top: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .hidden { display: none; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBZ7hDc7YCICyEwWNTJR2vSRfnXzvSDnwg",
      authDomain: "generator-checklist-c18f4.firebaseapp.com",
      projectId: "generator-checklist-c18f4",
      storageBucket: "generator-checklist-c18f4.firebasestorage.app",
      messagingSenderId: "312203329174",
      appId: "1:312203329174:web:e28a947600a6bf4e1f4cb7",
      measurementId: "G-STG0YEL1PG"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.saveToFirebase = async function(data) {
      await addDoc(collection(db, "checklists"), data);
    };

    window.loadReports = async function() {
      const querySnapshot = await getDocs(collection(db, "checklists"));
      const tbody = document.getElementById("report-body");
      tbody.innerHTML = "";
      querySnapshot.forEach((doc) => {
        const d = doc.data();
        const row = document.createElement("tr");
        row.setAttribute("data-date", d.date || "");
        const values = [
          d.name, d.phaseR, d.phaseS, d.phaseT, d.status,
          d.oil ? "‚úî" : "", d.coolant ? "‚úî" : "", d.battery ? "‚úî" : "",
          d.startTime, d.stopTime, d.note
        ];
        values.forEach(val => {
          const cell = document.createElement("td");
          cell.textContent = val;
          row.appendChild(cell);
        });

        const imageCell = document.createElement("td");
        if (d.imageName && d.imageName.startsWith("data:image")) {
          const img = document.createElement("img");
          img.src = d.imageName;
          img.style.maxWidth = "100px";
          imageCell.appendChild(img);
        } else {
          imageCell.textContent = d.imageName || "";
        }
        row.appendChild(imageCell);

        const dateCell = document.createElement("td");
        dateCell.classList.add("hidden");
        dateCell.textContent = d.date;
        row.appendChild(dateCell);

        tbody.appendChild(row);
      });
    };

    window.addEventListener("load", loadReports);
  </script>
</head>
<body>
  <h1>Generator Inspection Checklist</h1>
  <form id="checklist-form">
    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≤‡∏á</label>
    <input list="technicians" name="technician-name" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"/>
    <datalist id="technicians"></datalist>
    <button type="button" class="add-button" onclick="addTechnician()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠</button>

    <label>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÄ‡∏ü‡∏™ R</label>
    <input type="number" name="phaseR" placeholder="‡πÄ‡∏ä‡πà‡∏ô 230" />

    <label>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÄ‡∏ü‡∏™ S</label>
    <input type="number" name="phaseS" placeholder="‡πÄ‡∏ä‡πà‡∏ô 230" />

    <label>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÄ‡∏ü‡∏™ T</label>
    <input type="number" name="phaseT" placeholder="‡πÄ‡∏ä‡πà‡∏ô 230" />

    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
    <select name="status">
      <option value="‡∏ó‡∏≥‡∏á‡∏≤‡∏ô">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</option>
      <option value="‡∏´‡∏¢‡∏∏‡∏î">‡∏´‡∏¢‡∏∏‡∏î</option>
    </select>

    <label>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</label>
    <label><input type="checkbox" name="oil" /> ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á <span class="instructions">‚Äì ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</span></label>
    <label><input type="checkbox" name="coolant" /> ‡∏ô‡πâ‡∏≥‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô <span class="instructions">‚Äì ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</span></label>
    <label><input type="checkbox" name="battery" /> ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà <span class="instructions">‚Äì ‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÑ‡∏ü‡∏Ç‡∏≠‡∏á‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</span></label>

    <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
    <input type="time" name="startTime" />

    <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
    <input type="time" name="stopTime" />

    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
    <textarea name="note" rows="4"></textarea>

    <label>‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢</label>
    <input type="file" name="image" accept="image/*" />

    <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </form>

  <h2>üìÇ¬†‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h2>
  <label>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
  <input type="date" id="search-date" onchange="filterReports()" />

  <table id="report-table">
    <thead>
      <tr>
        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≤‡∏á</th>
        <th>R</th>
        <th>S</th>
        <th>T</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</th>
        <th>‡∏ô‡πâ‡∏≥‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô</th>
        <th>‡πÅ‡∏ö‡∏ï‡∏Ø</th>
        <th>‡πÄ‡∏£‡∏¥‡πà‡∏°</th>
        <th>‡∏´‡∏¢‡∏∏‡∏î</th>
        <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
        <th>‡∏£‡∏π‡∏õ</th>
        <th class="hidden">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
      </tr>
    </thead>
    <tbody id="report-body"></tbody>
  </table>
  <button onclick="printReport()">üñ∏Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>

  <script>
    function addTechnician() {
      const name = prompt("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà:");
      if (name) {
        const dataList = document.getElementById("technicians");
        const option = document.createElement("option");
        option.value = name;
        dataList.appendChild(option);
        alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      }
    }

    function printReport() {
      const date = document.getElementById("search-date").value;
      const rows = Array.from(document.querySelectorAll("#report-body tr")).filter(row => !date || row.getAttribute("data-date") === date);
      const newTable = document.createElement("table");
      newTable.innerHTML = document.querySelector("#report-table thead").outerHTML;
      const tbody = document.createElement("tbody");
      rows.forEach(row => tbody.appendChild(row.cloneNode(true)));
      newTable.appendChild(tbody);
      const win = window.open("", "PrintWindow");
      win.document.write(`<!DOCTYPE html><html><head><title>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</title></head><body>${newTable.outerHTML}</body></html>`);
      win.document.close();
      win.print();
    }

    function filterReports() {
      const date = document.getElementById("search-date").value;
      const rows = document.querySelectorAll("#report-body tr");
      rows.forEach(row => {
        const rowDate = row.getAttribute("data-date");
        row.style.display = (!date || rowDate === date) ? "" : "none";
      });
    }

    document.getElementById("checklist-form").addEventListener("submit", async function(e) {
      e.preventDefault();
      const form = new FormData(e.target);
      const imageFile = form.get("image");
      const reader = new FileReader();
      reader.onload = async function(event) {
        const data = {
          name: form.get("technician-name"),
          phaseR: form.get("phaseR"),
          phaseS: form.get("phaseS"),
          phaseT: form.get("phaseT"),
          status: form.get("status"),
          oil: form.get("oil") !== null,
          coolant: form.get("coolant") !== null,
          battery: form.get("battery") !== null,
          startTime: form.get("startTime"),
          stopTime: form.get("stopTime"),
          note: form.get("note"),
          imageName: event.target.result || "",
          date: new Date().toISOString().split("T")[0]
        };
        await saveToFirebase(data);
        loadReports();
        e.target.reset();
      };
      if (imageFile && imageFile.size > 0) {
        reader.readAsDataURL(imageFile);
      } else {
        reader.onload({ target: { result: "" } });
      }
    });
  </script>
</body>
</html>
