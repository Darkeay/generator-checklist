<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body { font-family: sans-serif; padding: 20px; background: #f4f4f4; max-width: 600px; margin: auto; }
      h2 { color: #007BFF; text-align: center; }
      label { display: block; margin-top: 12px; }
      input, textarea, select { width: 100%; padding: 8px; margin-top: 4px; }
      button { margin-top: 20px; padding: 10px; width: 100%; background: #28a745; color: white; border: none; border-radius: 4px; font-size: 16px; }
      button:hover { background-color: #218838; }
      .link-report { text-align: center; margin-top: 20px; }
    </style>
  </head>
  <body>
    <h2>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏±‡πà‡∏ô‡πÑ‡∏ü</h2>

    <label>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</label>
    <select id="item">
      <option>‡∏ß‡∏≤‡∏•‡πå‡∏ß‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</option>
      <option>‡∏ñ‡∏±‡∏á‡∏™‡∏≥‡∏£‡∏≠‡∏á</option>
      <option>‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡πà‡∏≠</option>
      <option>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á</option>
      <option>‡∏û‡∏±‡∏î‡∏•‡∏°‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</option>
    </select>

    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
    <select id="status">
      <option value="‡∏ú‡πà‡∏≤‡∏ô">‚úîÔ∏è ‡∏ú‡πà‡∏≤‡∏ô</option>
      <option value="‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô">‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</option>
      <option value="‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°">‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°</option>
    </select>

    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</label>
    <textarea id="comment"></textarea>

    <label>‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</label>
    <input type="file" id="imageFile" accept="image/*" capture="environment">

    <button onclick="submitForm()">üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <p id="response"></p>

    <div class="link-report">
      <a href="?page=report" target="_blank">üìÑ ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</a>
    </div>

    <script>
      function submitForm() {
        const item = document.getElementById("item").value;
        const status = document.getElementById("status").value;
        const comment = document.getElementById("comment").value;
        const fileInput = document.getElementById("imageFile");
        const file = fileInput.files[0];

        if (file) {
          const reader = new FileReader();
          reader.onloadend = function () {
            const base64 = reader.result.split(",")[1];
            google.script.run.withSuccessHandler(url => {
              sendData(item, status, comment, url);
            }).uploadImage({ name: file.name, type: file.type, base64 });
          };
          reader.readAsDataURL(file);
        } else {
          sendData(item, status, comment, "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ");
        }
      }

      function sendData(item, status, comment, imageUrl) {
        google.script.run.withSuccessHandler(msg => {
          document.getElementById("response").textContent = msg;
          document.getElementById("comment").value = "";
          document.getElementById("imageFile").value = null;
        }).saveChecklist({ item, status, comment, imageUrl });
      }
    </script>
  </body>
</html>
