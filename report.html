
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>รายงานบันทึกการตรวจสอบเครื่องปั่นไฟ</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="p-6 bg-gray-100">
  <h1 class="text-2xl font-bold mb-4">รายงานบันทึกการตรวจสอบเครื่องปั่นไฟ</h1>
  <input type="text" id="search" placeholder="ค้นหาด้วยชื่อหรือวันเวลา" class="border p-2 mb-4 w-full max-w-md" />
  <button onclick="searchReports()" class="bg-blue-600 text-white px-4 py-2 rounded mb-4">ค้นหา</button>
  <div id="reportList"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBZ7hDc7YCICyEwWNTJR2vSRfnXzvSDnwg",
      authDomain: "generator-checklist-c18f4.firebaseapp.com",
      projectId: "generator-checklist-c18f4",
      storageBucket: "generator-checklist-c18f4.firebasestorage.app",
      messagingSenderId: "312203329174",
      appId: "1:312203329174:web:e28a947600a6bf4e1f4cb7",
      measurementId: "G-STG0YEL1PG"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    async function searchReports() {
      const term = document.getElementById("search").value.toLowerCase();
      const ref = db.ref("checklist");
      const snapshot = await ref.once("value");
      const data = snapshot.val();
      const reportList = document.getElementById("reportList");
      reportList.innerHTML = "";

      for (const id in data) {
        const item = data[id];
        const match = (item.inspector + item.timestamp).toLowerCase().includes(term);
        if (match) {
          const div = document.createElement("div");
          div.className = "bg-white p-4 rounded shadow mb-2";
          div.innerHTML = `<strong>${item.inspector}</strong><br/>${item.timestamp}<br/>เฟส R: ${item.voltageR}, S: ${item.voltageS}, T: ${item.voltageT}<br/>หมายเหตุ: ${item.note || "-"}<br/>`;
          reportList.appendChild(div);
        }
      }
    }
  </script>
</body>
</html>
